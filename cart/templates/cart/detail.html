{% extends "shop/base.html" %}
{% load static %}

{% block title %}
  Your shopping cart
{% endblock %}

{% block content %}
<div style="background-color: paleturquoise;">
<div class="text-center"><!-- ê°€ìš´ë°ì •ë ¬  -->
    <h1>ì¥ë°”êµ¬ë‹ˆ</h1>
</div>
<div class="container py-4">
    <!-- Flexboxë¥¼ ì‚¬ìš©í•˜ì—¬ ì¢Œìš°ë¡œ ë‚˜ë€íˆ ë°°ì¹˜ -->
    <div class="d-flex justify-content-between">
        <!-- ì™¼ìª½ ì˜ì—­: ìƒí’ˆ ëª©ë¡ -->
        <div class="card w-75 me-3">

            <div class="card-header">
                <input type="checkbox"> ì „ì²´ ì„ íƒ {{ 0 }}/{{ 0 }}
            </div>

            <div class="card-body">
                <!-- ifchanged íƒœê·¸ë¥¼ ì‚¬ìš©í•˜ì—¬ deliveryì™€ packagingì´ ë°”ë€” ë•Œë§Œ ì¶œë ¥ -->
                {% for item in sorted_cart %}
                    <!-- ë°°ì†¡ë°©ì‹ì´ ë°”ë€” ë•Œë§Œ ì¶œë ¥ -->
                    {% ifchanged item.product.delivery %}
                        <h3>{{ item.product.delivery }}</h3>
                    {% endifchanged %}

                    <!-- í¬ì¥ë°©ì‹ì´ ë°”ë€” ë•Œë§Œ ì¶œë ¥ -->
                    {% ifchanged item.product.packaging or item.product.delivery %} <!-- í¬ì¥ë°©ì‹ì€ ê·¸ëŒ€ë¡ ë° ë°°ì†¡ë°©ì‹ë§Œ ë°”ë€”ê²½ìš° í¬ì¥ë°©ì‹ì´ ì¶œë ¥ ì•ˆë˜ëŠ” ë¬¸ì œ -> or ì¡°ê±´ì¶”ê°€ë¡œ í•´ê²° -->
                        {% if item.product.packaging == 'ìƒì˜¨' %}
                            <h6 style="color: coral;">ğŸ”†{{ item.product.packaging }} ìƒí’ˆ</h6>
                        {% elif item.product.packaging == 'ëƒ‰ì¥' %}
                            <h6 style="color: rgb(45, 96, 236);">ğŸ’§{{ item.product.packaging }} ìƒí’ˆ</h6>
                        {% elif item.product.packaging == 'ëƒ‰ë™' %}
                            <h6 style="color: rgb(84, 246, 255);">â„ï¸{{ item.product.packaging }} ìƒí’ˆ</h6>
                        {% endif %}
                    {% endifchanged %}

                    <!-- ìƒí’ˆëª… ë° ì´ë¯¸ì§€ ì¶œë ¥ -->
                    <div class="card">
                        <div>{{ item.product.product_name }}</div>
                        <div style="float: right;">
                            <form action="{% url 'cart:cart_remove' item.product.id %}" method="post"> <!-- ì œê±°ë²„íŠ¼ -->
                                {% csrf_token %}
                                <button type="submit" style="float: right;">X</button>
                            </form>
                        </div>
                        <div class="d-flex justify-content-between" style="margin-left: 5px; margin-right: 5px;">
                            <div class="flex-grow-2" style="flex-basis: 30%;">
                                <a href="{{ item.product.get_absolute_url }}">
                                    <img src="{% if item.product.image %}{{ item.product.image.url }}{% else %}{% static 'img/no_image.png' %}{% endif %}" width="120" height="80">
                                </a>
                            </div>
                            <div class="flex-grow-2" style="flex-basis: 70%;">
                                <form action="{% url 'cart:cart_update' item.product.id %}" method="post">
                                    {% csrf_token %}
                                    <input type="submit" name="action" value="-">
                                    {{ item.quantity }}
                                    <input type="submit" name="action" value="+">
                                </form>
                            </div>
                        </div>
                    </div>
                {% endfor %}
                {% if not cart %}
                    <div style="text-align : center;">
                        <img src="{% static 'img/nothing_in_cart.png' %}" width="600" height="450">
                    </div>
                {% endif %}
            </div>
            <div class="card-footer">
                ìƒí’ˆ {{ cart.get_total_price }}ì› + ë°°ì†¡ë¹„ ë¬´ë£Œ<br>
                <strong>ì´ ê²°ì œê¸ˆì•¡: {{ cart.get_total_price }}ì›</strong> <!-- ë°°ì†¡ë¹„ ìƒê¸´ë‹¤ë©´ ì¶”ê°€í•˜ê¸° -->
            </div>
        </div>

        <!-- ì˜¤ë¥¸ìª½ ì˜ì—­: ê²°ì œ ì •ë³´ -->
        <div class="card w-25">
            <div class="card-body">
                <h5 class="card-title">ê²°ì œ ê¸ˆì•¡</h5>
                <p>ìƒí’ˆ ê¸ˆì•¡: {{ cart.get_total_price }}ì›</p>
                <p>ìƒí’ˆ í• ì¸ ê¸ˆì•¡: 0ì›</p>
                <p>ë°°ì†¡ë¹„: 0ì›</p>
                <hr>
                <p>ê²°ì œ ì˜ˆì • ê¸ˆì•¡: {{ cart.get_total_price }}ì›</p>
                <button type="button" class="btn btn-primary">
                    {% csrf_token %}
                    {% if user.is_authenticated %}
                        {% if not cart %}
                            <a>ìƒí’ˆì„ ë‹´ì•„ì£¼ì„¸ìš”</a>
                        {% else %}
                        <a href="{% url 'orders:order_create' %}">
                            ì£¼ë¬¸í•˜ê¸°
                        </a>
                        {% endif %}
                    {% else %}
                        <a href="{% url 'users:login' %}">ë¡œê·¸ì¸</a>
                    {% endif %}
                </button>  
            </div>
        </div>
    </div>
</div>
</div>
{% endblock %}
